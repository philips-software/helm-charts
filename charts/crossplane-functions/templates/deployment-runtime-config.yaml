{{- if .Values.features.deploymentRuntimeConfig }}
{{- range concat .Values.functions .Values.extraFunctions }}
---
apiVersion: pkg.crossplane.io/v1beta1
kind: DeploymentRuntimeConfig
metadata:
  name: {{ .name }}
spec:
  # Schedule critical functions on system nodes like other core components
  deploymentTemplate:
    metadata:
      name: {{ .name }}
    spec:
      selector: {}
      template:
        spec:
          containers:
            - name: package-runtime
              resources:
                {{- .resources | default $.Values.resources | toYaml | nindent 16 }}
          {{- if .critical }}
          {{- with $.Values.criticalFunctions.affinity }}
          affinity:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- with $.Values.criticalFunctions.tolerations }}
          tolerations:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- end }}
{{- end }}
{{- end }}